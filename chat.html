<!DOCTYPE html>
<html>
<head>
<title>Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Inter;background:#f3f4f6;padding:20px}
#messages{height:400px;overflow:auto;background:white;padding:15px;border-radius:8px;margin-bottom:10px}
input{width:80%;padding:10px}
button{padding:10px}
</style>
</head>
<body>

<h2>Private Chat</h2>
<div id="messages"></div>
<input id="msg" placeholder="Type message">
<button onclick="send()">Send</button>

<script src="firebase.js"></script>
<script>
let currentUser;
let otherUser=new URLSearchParams(window.location.search).get("uid");

auth.onAuthStateChanged(user=>{
  if(!user){window.location="index.html";}
  else{currentUser=user.uid;loadMessages();}
});

function loadMessages(){
  db.collection("messages")
  .orderBy("timestamp")
  .onSnapshot(snapshot=>{
    messages.innerHTML="";
    snapshot.forEach(doc=>{
      let data=doc.data();
      if(
        (data.sender===currentUser && data.receiver===otherUser) ||
        (data.sender===otherUser && data.receiver===currentUser)
      ){
        messages.innerHTML+=`<div>${data.text}</div>`;
      }
    });
  });
}

function send(){
  db.collection("messages").add({
    sender:currentUser,
    receiver:otherUser,
    text:msg.value,
    timestamp:new Date()
  });
  msg.value="";
}
</script>

</body>
</html>
